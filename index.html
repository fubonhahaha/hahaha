<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- iOS Web App è¨­å®šï¼šè®“ç¶²é é–‹å•Ÿæ™‚éš±è—ç€è¦½å™¨ç¶²å€åˆ—ï¼Œåƒ App ä¸€æ¨£ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æŠ½çå¤§å¸«">
    <title>å°ˆæ¥­ä¸é‡è¤‡æŠ½çç³»çµ±</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #007aff; --danger: #ff3b30; --bg: #f2f2f7; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); padding: 20px; display: flex; flex-direction: column; align-items: center; -webkit-tap-highlight-color: transparent; }
        .card { background: white; width: 100%; max-width: 450px; padding: 25px; border-radius: 20px; box-shadow: 0 8px 30px rgba(0,0,0,0.08); text-align: center; margin-bottom: 20px; box-sizing: border-box; }
        h2 { margin-top: 0; color: #1c1c1e; }
        .input-group { text-align: left; margin-bottom: 15px; }
        label { font-size: 13px; font-weight: 600; color: #8e8e93; text-transform: uppercase; margin-bottom: 5px; display: block; }
        textarea { width: 100%; height: 100px; border: 1px solid #d1d1d6; border-radius: 12px; padding: 12px; box-sizing: border-box; font-size: 15px; line-height: 1.5; outline: none; transition: 0.2s; }
        .status-bar { display: flex; justify-content: space-between; font-size: 13px; color: #8e8e93; margin-bottom: 15px; }
        .count-tag { background: #e5e5ea; padding: 2px 8px; border-radius: 6px; color: #3a3a3c; }
        .btn { background: var(--primary); color: white; border: none; padding: 16px; width: 100%; border-radius: 14px; font-size: 18px; font-weight: 600; cursor: pointer; transition: 0.2s; margin-top: 10px; }
        .btn:active { transform: scale(0.97); opacity: 0.8; }
        .btn:disabled { background: #d1d1d6; }
        #result { font-size: 36px; color: var(--danger); font-weight: 800; margin: 25px 0; min-height: 60px; display: flex; align-items: center; justify-content: center; background: #fff5f5; border-radius: 15px; border: 2px solid #ffebeb; }
        .winner-card { background: white; width: 100%; max-width: 450px; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); box-sizing: border-box; }
        .winner-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f2f2f7; padding-bottom: 12px; margin-bottom: 12px; }
        .btns-small { display: flex; gap: 10px; }
        .btn-text { background: none; border: none; color: var(--primary); font-size: 14px; cursor: pointer; }
        #historyList { list-style: none; padding: 0; margin: 0; }
        #historyList li { padding: 12px; border-bottom: 1px solid #f2f2f7; display: flex; align-items: center; }
        .rank { background: #ff9500; color: white; width: 22px; height: 22px; border-radius: 50%; font-size: 11px; display: flex; align-items: center; justify-content: center; margin-right: 12px; flex-shrink: 0; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ æ–°æ˜¥ğŸä¸Šå‚³ï¼Œç™¼è²¡é‡‘åé€£æŠ½ğŸ§§</h2>
    <div class="input-group">
        <label>åå–®è¨­å®š (Excel æˆ– æ‰‹å‹•è¼¸å…¥)</label>
        <textarea id="rawNames" placeholder="è«‹åœ¨æ­¤è¼¸å…¥åå–®..." oninput="syncNames()"></textarea>
        <input type="file" id="fileInput" accept=".xlsx, .xls" style="margin-top: 10px; width: 100%; font-size: 12px;" />
    </div>
    <div class="status-bar">
        <span>å¾…æŠ½æ± ï¼š<span class="count-tag" id="countInfo">0 äºº</span></span>
    </div>
    <div id="result">æº–å‚™æŠ½ç</div>
    <button id="drawBtn" class="btn" onclick="startDraw()">æŠ½å‡ºä¸€ä½å¹¸é‹å…’</button>
</div>

<div class="winner-card">
    <div class="winner-header">
        <span style="font-weight:700">ğŸ† å¾—çåå–®</span>
        <div class="btns-small">
            <button class="btn-text" onclick="copyWinners()">è¤‡è£½</button>
            <button class="btn-text" style="color:red" onclick="resetAll()">é‡è¨­</button>
        </div>
    </div>
    <ul id="historyList"><li style="text-align:center; color:#ccc">å°šæœªæŠ½å‡º</li></ul>
</div>

<script>
    let namesPool = [];
    let winnersList = [];

    function syncNames() {
        const text = document.getElementById('rawNames').value;
        namesPool = text.split('\n').map(n => n.trim()).filter(n => n !== "");
        document.getElementById('countInfo').innerText = namesPool.length + " äºº";
        document.getElementById('drawBtn').disabled = (namesPool.length === 0);
    }

    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(event) {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const json = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], { header: 1 });
            const importedNames = json.map(row => row[0]).filter(n => n !== undefined && String(n).trim() !== "");
            document.getElementById('rawNames').value = importedNames.join('\n');
            syncNames();
        };
        reader.readAsArrayBuffer(file);
    });

    function startDraw() {
        if (namesPool.length === 0) return;
        const btn = document.getElementById('drawBtn');
        const resDiv = document.getElementById('result');
        btn.disabled = true;

        let counter = 0;
        let timer = setInterval(() => {
            resDiv.innerText = namesPool[Math.floor(Math.random() * namesPool.length)];
            if (++counter > 20) {
                clearInterval(timer);
                const finalIndex = Math.floor(Math.random() * namesPool.length);
                const winner = namesPool.splice(finalIndex, 1)[0];
                resDiv.innerText = "ğŸŠ " + winner;
                winnersList.push(winner);
                document.getElementById('rawNames').value = namesPool.join('\n');
                updateUI();
                btn.disabled = (namesPool.length === 0);
            }
        }, 60);
    }

    function updateUI() {
        document.getElementById('countInfo').innerText = namesPool.length + " äºº";
        const list = document.getElementById('historyList');
        list.innerHTML = winnersList.map((name, i) => `<li><span class="rank">${i+1}</span><span style="flex-grow:1">${name}</span></li>`).reverse().join('');
    }

    function copyWinners() {
        const text = winnersList.map((name, i) => `ç¬¬${i+1}åï¼š${name}`).join('\n');
        navigator.clipboard.writeText(text).then(() => alert("å·²è¤‡è£½å¾—çåå–®"));
    }

    function resetAll() {
        if (confirm("ç¢ºå®šé‡è¨­ï¼Ÿ")) {
            winnersList = []; namesPool = [];
            document.getElementById('rawNames').value = "";
            document.getElementById('result').innerText = "æº–å‚™æŠ½ç";
            updateUI();
        }
    }
</script>
</body>

</html>


