<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸é‡è¤‡æŠ½çç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #007aff; --danger: #ff3b30; --bg: #f2f2f7; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; width: 100%; max-width: 450px; padding: 25px; border-radius: 20px; box-shadow: 0 8px 30px rgba(0,0,0,0.08); text-align: center; margin-bottom: 20px; }
        h2 { margin-top: 0; color: #1c1c1e; }
        
        /* è¼¸å…¥å€ */
        .input-group { text-align: left; margin-bottom: 15px; }
        label { font-size: 13px; font-weight: 600; color: #8e8e93; text-transform: uppercase; margin-bottom: 5px; display: block; }
        textarea { width: 100%; height: 100px; border: 1px solid #d1d1d6; border-radius: 12px; padding: 12px; box-sizing: border-box; font-size: 15px; line-height: 1.5; outline: none; transition: 0.2s; }
        textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,122,255,0.1); }
        
        /* ç‹€æ…‹é¡¯ç¤º */
        .status-bar { display: flex; justify-content: space-between; font-size: 13px; color: #8e8e93; margin-bottom: 15px; }
        .count-tag { background: #e5e5ea; padding: 2px 8px; border-radius: 6px; color: #3a3a3c; }

        /* æŠ½çæŒ‰éˆ• */
        .btn { background: var(--primary); color: white; border: none; padding: 16px; width: 100%; border-radius: 14px; font-size: 18px; font-weight: 600; cursor: pointer; transition: 0.2s; margin-top: 10px; }
        .btn:active { transform: scale(0.97); opacity: 0.8; }
        .btn:disabled { background: #d1d1d6; cursor: not-allowed; }

        /* çµæœå±•ç¤º */
        #result { font-size: 36px; color: var(--danger); font-weight: 800; margin: 25px 0; min-height: 60px; display: flex; align-items: center; justify-content: center; background: #fff5f5; border-radius: 15px; border: 2px solid #ffebeb; }

        /* å¾—çåå–®ç´…æ¦œ */
        .winner-card { background: white; width: 100%; max-width: 450px; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
        .winner-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f2f2f7; padding-bottom: 12px; margin-bottom: 12px; }
        .winner-title { font-weight: 700; color: #1c1c1e; }
        .btns-small { display: flex; gap: 10px; }
        .btn-text { background: none; border: none; color: var(--primary); font-size: 14px; cursor: pointer; padding: 0; }
        .btn-text.red { color: var(--danger); }

        #historyList { list-style: none; padding: 0; margin: 0; }
        #historyList li { padding: 12px; border-bottom: 1px solid #f2f2f7; display: flex; align-items: center; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .rank { background: #ff9500; color: white; width: 22px; height: 22px; border-radius: 50%; font-size: 11px; display: flex; align-items: center; justify-content: center; margin-right: 12px; flex-shrink: 0; }
        .name { font-weight: 500; color: #1c1c1e; flex-grow: 1; }
        .tip { font-size: 11px; color: #aeaeb2; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ æ–°æ˜¥è¶…ç´šæŠ½ç</h2>

    <div class="input-group">
        <label>åå–®è¨­å®š (Excel åŒ¯å…¥æˆ–æ‰‹å‹•è¼¸å…¥)</label>
        <textarea id="rawNames" placeholder="è«‹åœ¨æ­¤è¼¸å…¥åå–®ï¼Œæ¯è¡Œä¸€å€‹åå­—..." oninput="syncNames()"></textarea>
        <input type="file" id="fileInput" accept=".xlsx, .xls" style="margin-top: 10px; width: 100%; font-size: 12px;" />
    </div>

    <div class="status-bar">
        <span>ç›®å‰å¾…æŠ½æ± ï¼š</span>
        <span class="count-tag" id="countInfo">0 äºº</span>
    </div>
    
    <div id="result">æº–å‚™æŠ½ç</div>

    <button id="drawBtn" class="btn" onclick="startDraw()">æŠ½å‡ºä¸€ä½å¹¸é‹å…’</button>
</div>

<div class="winner-card">
    <div class="winner-header">
        <span class="winner-title">ğŸ† å¾—çåå–®å…¬å¸ƒ</span>
        <div class="btns-small">
            <button class="btn-text" onclick="copyWinners()">è¤‡è£½åå–®</button>
            <button class="btn-text red" onclick="resetAll()">æ¸…ç©ºé‡ä¾†</button>
        </div>
    </div>
    <ul id="historyList">
        <li style="justify-content: center; color: #c7c7cc;">å°šæœªæŠ½å‡ºä¸­çè€…</li>
    </ul>
</div>

<script>
    let namesPool = []; // å¾…æŠ½åå–®
    let winnersList = []; // å·²ä¸­çåå–®

    // åŒæ­¥æ–‡å­—æ¡†å…§å®¹åˆ°åå–®æ± 
    function syncNames() {
        const text = document.getElementById('rawNames').value;
        namesPool = text.split('\n').map(n => n.trim()).filter(n => n !== "");
        document.getElementById('countInfo').innerText = namesPool.length + " äºº";
        
        // å¦‚æœåå–®è¢«æ¸…ç©ºï¼Œç¦ç”¨æŒ‰éˆ•
        document.getElementById('drawBtn').disabled = (namesPool.length === 0);
    }

    // è™•ç† Excel åŒ¯å…¥
    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(event) {
            try {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const json = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                // æŠ“å–ç¬¬ä¸€æ¬„
                const importedNames = json.map(row => row[0]).filter(n => n !== undefined && String(n).trim() !== "");
                document.getElementById('rawNames').value = importedNames.join('\n');
                syncNames();
                alert("æˆåŠŸåŒ¯å…¥ " + importedNames.length + " äººï¼");
            } catch (err) {
                alert("æª”æ¡ˆè®€å–å¤±æ•—ï¼Œè«‹ç¢ºèªæ ¼å¼");
            }
        };
        reader.readAsArrayBuffer(file);
    });

    function startDraw() {
        if (namesPool.length === 0) {
            alert("æŠ½çæ± å·²ç©ºï¼è«‹é‡æ–°è¼¸å…¥åå–®ã€‚");
            return;
        }

        const btn = document.getElementById('drawBtn');
        const resDiv = document.getElementById('result');
        btn.disabled = true;

        // æ»¾å‹•å‹•ç•«æ•ˆæœ
        let counter = 0;
        const duration = 20; // æ»¾å‹•æ¬¡æ•¸
        let timer = setInterval(() => {
            let randomIndex = Math.floor(Math.random() * namesPool.length);
            resDiv.innerText = namesPool[randomIndex];
            counter++;
            
            if (counter > duration) {
                clearInterval(timer);
                executePick();
            }
        }, 60);
    }

    function executePick() {
        const resDiv = document.getElementById('result');
        const btn = document.getElementById('drawBtn');
        
        // æ ¸å¿ƒé‚è¼¯ï¼šéš¨æ©Ÿé¸å–ä¸¦ç§»é™¤ (Splice)
        const finalIndex = Math.floor(Math.random() * namesPool.length);
        const winner = namesPool.splice(finalIndex, 1)[0]; // å¾é™£åˆ—ä¸­å–å‡ºä¸¦åˆªé™¤
        
        // æ›´æ–°é¡¯ç¤º
        resDiv.innerText = "ğŸŠ " + winner;
        winnersList.push(winner);

        // åŒæ­¥å›æ–‡å­—æ¡†ï¼Œè®“ä½¿ç”¨è€…çœ‹åˆ°åå–®æ¸›å°‘äº†
        document.getElementById('rawNames').value = namesPool.join('\n');
        
        updateUI();
        btn.disabled = (namesPool.length === 0);
    }

    function updateUI() {
        // æ›´æ–°å¾…æŠ½äººæ•¸
        document.getElementById('countInfo').innerText = namesPool.length + " äºº";

        // æ›´æ–°å¾—çåå–®åˆ—è¡¨
        const list = document.getElementById('historyList');
        if (winnersList.length === 0) {
            list.innerHTML = '<li style="justify-content: center; color: #c7c7cc;">å°šæœªæŠ½å‡ºä¸­çè€…</li>';
            return;
        }

        // å€’åºé¡¯ç¤ºï¼Œæœ€æ–°å¾—çè€…åœ¨æœ€ä¸Šé¢
        const html = winnersList.map((name, index) => `
            <li>
                <span class="rank">${index + 1}</span>
                <span class="name">${name}</span>
                <span class="tip">ä¸­ç</span>
            </li>
        `).reverse().join('');
        list.innerHTML = html;
    }

    function copyWinners() {
        if (winnersList.length === 0) return;
        const text = winnersList.map((name, i) => `ç¬¬${i+1}ä½å¾—çè€…ï¼š${name}`).join('\n');
        navigator.clipboard.writeText(text).then(() => alert("åå–®å·²è¤‡è£½ï¼"));
    }

    function resetAll() {
        if (confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ç´€éŒ„é‡æ–°é–‹å§‹å—ï¼Ÿ")) {
            winnersList = [];
            namesPool = [];
            document.getElementById('rawNames').value = "";
            document.getElementById('result').innerText = "æº–å‚™æŠ½ç";
            updateUI();
        }
    }
</script>

</body>
</html>